FROM node:16-alpine
  ARG USER_ID=1000
  ENV USER_ID=$USER_ID
  ARG TZ=Europe/Moscow
  
  RUN apk add python3 make wget
  RUN cd /opt && wget https://repo.bitrix.info/vm/push-server-0.3.0.tgz
  RUN cd /opt && npm install --production ./push-server-0.3.0.tgz
  #RUN echo 'd /tmp/push-server 0770 apache apache -' > /etc/tmpfiles.d/push-server.conf
  
  COPY push-server-multi /etc/sysconfig/push-server-multi
  COPY ./supervisor/supervisord.ini /etc/supervisord.d/supervisord.ini
  EXPOSE 8010-8015
  EXPOSE 9010-9011
  #EXPOSE 8895
  #EXPOSE 80
  CMD [ "/entrypoint.sh" ]

